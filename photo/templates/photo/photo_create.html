{% extends 'myapp/base.html' %}

{% block title %}Create Photo{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="https://unpkg.com/@yaireo/tagify/dist/tagify.css">
{% endblock %}

{% block content %}
    <h1 class="text-center mb-4">Create a new photo</h1>

    <div class="row justify-content-center">

        <div class="col-md-6">
            <!-- Add a CSS class to the attention div -->
            <div class="attention-phrase">
                Hey, can you try uploading a photo that has location info?
            </div>
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <textarea name="{{ form.comment.html_name }}" class="form-control mb-3" id="{{ form.comment.auto_id }}" placeholder="Add a comment"></textarea>
                <input type="file" name="{{ form.image.html_name }}" class="form-control" id="{{ form.image.auto_id }}">

                <!-- Add tags input field -->
                <div class="form-group mt-3">
                    <label for="id_tags">Tags:</label>
                    <input type="text" class="form-control" name="tags" id="id_tags" placeholder="Select or type tags">
                </div>

                <div class="text-center mt-3">
                    <button type="submit" class="btn btn-primary">Upload</button>
                </div>
            </form>
        </div>
    </div>

    <style>
        /* Add CSS styles for the attention phrase */
        .attention-phrase {
            font-weight: bold;
            color: blue;
            font-size: 1.0em;
            margin-bottom: 1em;
        }
    </style>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/@yaireo/tagify"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Tagify on the tags input field
        var inputElement = document.querySelector('#id_tags');
        var tagify = new Tagify(inputElement, {
            whitelist: {{ tags_json|safe }},
            placeholder: 'Select or type tags',
            enforceWhitelist: false,
            dropdown: {
                enabled: 0
            }
        });

        // Update the hidden input field with the tag values
        tagify.on('change', function (e) {
            var tags = tagify.value;
            var tagsArray = tags.map(tag => tag.value);
            inputElement.value = tagsArray.join(',');
        });
    });
</script>
{% endblock %}


